<!DOCTYPE html>

<!-- 查询栏 -->
<css href="/Public/Lib/jquery-file-upload-9.19.1/css/jquery.fileupload.css" />
<css href="/Public/Lib/jquery-file-upload-9.19.1/css/jquery.fileupload-ui.css" />

<div class="header">
    <h2 class="page-header">活动管理</h1>
</div>

<div id="page-inner">
    <div class="row">
        <div class="col-xs-12">
            <div class="panel panel-default">
                <div class="panel-body">
                    <ul class="nav nav-tabs chart-tab act-conf">
                        <li class="active"><a href="#" data-toggle="tab">基础配置</a></li>
                        <li><a href="#" data-toggle="tab">分享配置</a></li>
                    </ul>
                    <div class='tab-content'>
                        <form class="form-inline" role="form">
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered table-hover dataTable no-footer">
                                    <tbody>
                                        <tr>
                                            <td class="col-md-2">活动ID</td>
                                            <td>1</td>
                                        </tr>
                                        <tr>
                                            <td>活动名称</td>
                                            <td>粮油活动</td>
                                        </tr>
                                        <tr>
                                            <td>活动时间</td>
                                            <td>
                                                <div class="input-group">
                                                    <input class="form-control" name="stime" type="text" readonly="readonly" placeholder="开始时间"/>
                                                </div>
                                                 ~
                                                <div class="input-group">
                                                    <input class="form-control" name="stime" type="text" readonly="readonly" placeholder="结束时间"/>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>上线渠道</td>
                                            <td>

                                            </td>
                                        </tr>
                                        <tr>
                                            <td>默认头像</td>
                                            <td><input class="form-control" type="text" name=""/></td>
                                        </tr>
                                        <tr>
                                            <td>领奖条件(玩牌7日)</td>
                                            <td>
                                                <div class="input-group">
                                                    <input class="form-control" name="expired_time" type="text">
                                                    <span class="input-group-addon">  天</span>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>领奖条件(邀请人数)</td>
                                            <td>
                                                <div class="input-group">
                                                    <input class="form-control" name="expired_time" type="text">
                                                    <span class="input-group-addon">  天</span>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>俱乐部msg显示条数</td>
                                            <td><input class="form-control" type="text" name=""/></td>
                                        </tr>
                                        <tr>
                                            <td>获奖列表显示条数</td>
                                            <td><input class="form-control" type="text" name=""/></td>
                                        </tr>
                                        <tr>
                                            <td>任务完成时间</td>
                                            <td>
                                                <div class="input-group">
                                                    <input class="form-control" name="expired_time" type="text">
                                                    <span class="input-group-addon">  天</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </form>
                    </div>
                    <div class='tab-content' hidden>
                        <form class="form-horizontal" id="fhallForm">
                            <fieldset id="fhallSysFS" >
                                <div class="form-group">
                                    <label class="col-sm-3 control-label text-info request" for="fhallCont">
                                        <span class="tiptip" title="内容必须带一个URL地址，用中括号括起来，例 [http://www.stevengame.com/]">分享语句</span>
                                    </label>
                                    <div class="col-sm-8">
                                        <textarea class="form-control" id="fhallCont" name="cont" rows="5"></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label text-info request" for="fhallQrcodeX">
                                        <span class="tiptip" title="二维码相对背景图的锚点，取值范围为0~1，0.5表示居中">二维码x锚点</span>
                                    </label>
                                    <div class="col-sm-2">
                                        <input class="form-control" id="fhallQrcodeX" name="qrcode_x" type="text" />
                                    </div>
                                    <label class="col-sm-2 control-label request" for="fhallQrcodeY">y锚点</label>
                                    <div class="col-sm-2">
                                        <input class="form-control" id="fhallQrcodeY" name="qrcode_y" type="text" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label text-info request">
                                        <span class="tiptip" title="JPG图片，图片尺寸不能小于150x150">背景图</span>
                                    </label>
                                    <div class="col-sm-6">
                                        <span class="btn btn-success fileinput-button" id="fhallBgBtn" data-tag="add">
                                            <span>上传</span>
                                            <span class="badge" id="fhallBgBadge">
                                                <span class="glyphicon glyphicon-arrow-up"></span>
                                            </span>
                                            <input type="file" name="bg_image" id="fhallBgInput" />
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group" id="fhallBgPreviewDiv" hidden>
                                    <div class="col-sm-2 col-sm-offset-2">
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<js href="/Public/Lib/jquery-file-upload-9.19.1/js/vendor/jquery.ui.widget.js" />
<js href="/Public/Lib/jquery-file-upload-9.19.1/js/jquery.fileupload.js" />
<script>
    $(function(){
        $('.act-conf li').on('click', function(e) {
            var index = $(this).index();
            $(".tab-content").hide();
            $(".tab-content").eq(index).show();
        });

        var bgInput =  $('#fhallBgInput');
        var bgButtion =  $('#fhallBgBtn');
        var bgPreview =  $('#fhallBgPreviewDiv');
        var bgBgBadge =  $('#fhallBgBadge');
        $('#fhallBgInput').fileupload({
            url: "/Activity/ajaxShareUploadBgImg"
        }).on('fileuploadstart', function (e, data) {
            // 上传 input,提交input disabled
            bgInput.prop('disabled', true);
            bgButtion.prop('disabled', true);
            // 图片上传按钮切换为进度样式
            bgBgBadge.empty().append(
                $('<span/>').text("0%")
            );
        }).on('fileuploadprogress', function (e, data) {
            // 更新进度值
            var progress = parseInt(data.loaded / data.total * 100, 10);
            bgButtion.children().text(progress + "%");
        }).on('fileuploadalways', function(e, data) {
            // 上传 input enabled
            bgInput.prop('disabled', false);
            bgButtion.prop('disabled', false);

            if (0 == data.result.code) {
                // 先隐藏预览框
                bgPreview.fadeOut("fast", function() {
                    // 先清掉旧图片，再添加新图片并显示出来
                    bgPreview.children().empty().append(
                        $('<img/>').css("box-shadow", "0px 0px 3px #565656").css('max-width', '100%').attr({
                            id: 'fhallBg',
                            src: data.result.data.imgUrl
                        }).data('savename', data.result.data.saveName)
                    );
                    bgPreview.fadeIn("slow");
                });

                // 添加后将图片上传按钮的样式改为修改样式
                setTimeout(function() {
                    bgButtion.fadeOut('slow', function() {
                        if ("add" == bgButtion.data('tag')) {
                            bgButtion.removeClass('btn-success').addClass('btn-primary').data('tag', 'edit');
                        }
                        bgBgBadge.empty().append(
                            $('<span/>').addClass("glyphicon glyphicon-edit")
                        );
                        bgButtion.fadeIn('slow');
                    });
                }, 1000);
            } else {
                // 上传出错，将按钮Badge还原
                if ("add" == bgButtion.data('tag')) {
                    bgBgBadge.empty().append(
                        $('<span/>').addClass("glyphicon glyphicon-arrow-up")
                    );
                } else {
                    bgBgBadge.empty().append(
                        $('<span/>').addClass("glyphicon glyphicon-edit")
                    );
                }
                // 弹出错误信息
                if (data.result.msg) {
                    $.zmsg.error(data.result.msg);
                } else {
                    $.zmsg.fatal(data.result);
                }
            }
        });
    })
</script>
